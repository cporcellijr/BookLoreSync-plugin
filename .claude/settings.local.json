{
  "permissions": {
    "allow": [
      "Bash(luac:*)",
      "Bash(lua:*)",
      "Bash(cat:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\n[Feature] Add bidirectional sync and fix shelf removal bugs\n\nMajor features:\n1. Bidirectional sync - Download books from Booklore shelf to KOReader\n   - New syncFromBookloreShelf() function with smart deduplication\n   - Downloads books from configured shelf to /mnt/onboard/Books/\n   - Checks database cache to avoid re-downloading existing books\n   - Auto-sync on device wake (optional, disabled by default)\n   - Manual \"Sync Now\" menu option\n   - Menu: \"Sync from Booklore Shelf\" -> \"Sync Now\" / \"Auto-Sync on Wake\"\n\n2. API client enhancements based on real Swagger documentation\n   - Added getBooksInShelf() - GET /api/v1/shelves/{shelfId}/books\n   - Added downloadBook() - streams book files to disk with error handling\n   - Added _normalizeShelfBookObject() - handles metadata.authors array\n   - Maps bookType field to extension (EPUB -> epub)\n   - Extracts ISBNs from nested metadata object\n\n3. Fixed shelf removal bugs\n   - Optimized with cached book_id from database (skips API search)\n   - Enhanced preDeleteHook() to retrieve book_id from cache\n   - Fixed JSON encoding: empty arrays now encode as [] not {}\n   - Added setmetatable(__jsontype = \"array\") for proper JSON serialization\n   - Updated both single-file and bulk deletion hooks\n\n4. Bug fixes\n   - Fixed syntax errors: removed triple-dash comment blocks (--- -> --)\n   - Added better logging for deletion workflow\n   - Auto-sync waits 2 seconds for WiFi initialization on wake\n\nTechnical details:\n- Book download uses ltn12 streaming (memory efficient)\n- Filename generation: \"Author - Title.extension\" with sanitization\n- Database integration for all downloaded books (hash + metadata cached)\n- File browser auto-refresh after successful sync\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")"
    ],
    "deny": [],
    "ask": []
  }
}
